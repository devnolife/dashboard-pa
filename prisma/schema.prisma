generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  MAHASISWA
  DOSEN
}

enum StatusBimbingan {
  MENUNGGU
  DISETUJUI
  DITOLAK
  SELESAI
}

model User {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  role      Role
  nim       String?  @unique // untuk mahasiswa
  nip       String?  @unique // untuk dosen
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relasi mahasiswa - dosen PA
  dosenPaId    String?
  dosenPa      User?        @relation("BimbinganPA", fields: [dosenPaId], references: [id])
  mahasiswaPa  User[]       @relation("BimbinganPA")

  // Relasi ke bimbingan
  bimbinganMahasiswa Bimbingan[] @relation("MahasiswaBimbingan")
  bimbinganDosen     Bimbingan[] @relation("DosenBimbingan")

  @@map("users")
}

model Bimbingan {
  id          String          @id @default(cuid())
  judul       String
  deskripsi   String
  catatan     String?         // catatan dari dosen
  status      StatusBimbingan @default(MENUNGGU)
  tanggal     DateTime        @default(now())
  
  mahasiswaId String
  mahasiswa   User            @relation("MahasiswaBimbingan", fields: [mahasiswaId], references: [id])
  
  dosenId     String
  dosen       User            @relation("DosenBimbingan", fields: [dosenId], references: [id])

  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@map("bimbingan")
}
